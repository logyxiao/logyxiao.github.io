<!DOCTYPE html><html lang="zh-cn" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Logyxiao's Blog" href="https://logyxiao.cc/rss.xml"><meta name="generator" content="Astro v5.13.5"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://logyxiao.cc/blog/frontend/strapi/"><!-- Primary Meta Tags --><title>「Strapi」无头CMS，快速构建API</title><meta name="title" content="「Strapi」无头CMS，快速构建API"><meta name="description" content="Strapi是一个免费的开源无头 CMS，可以快速构建自己所需的 API"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://logyxiao.cc/blog/frontend/strapi/"><meta property="og:title" content="「Strapi」无头CMS，快速构建API"><meta property="og:description" content="Strapi是一个免费的开源无头 CMS，可以快速构建自己所需的 API"><meta property="og:image" content="https://logyxiao.cc/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://logyxiao.cc/blog/frontend/strapi/"><meta property="twitter:title" content="「Strapi」无头CMS，快速构建API"><meta property="twitter:description" content="Strapi是一个免费的开源无头 CMS，可以快速构建自己所需的 API"><meta property="twitter:image" content="https://logyxiao.cc/_astro/blog-placeholder-1.Bx0Zcyzv.jpg"><link rel="stylesheet" href="/_astro/about.D7LVy5UF.css">
<link rel="stylesheet" href="/_astro/about.4em2NtKp.css"></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Logyxiao&#39;s Blog</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/zh-cn/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> 首页 </a>  <a href="/zh-cn/blog" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> 博客 </a>  <a href="/zh-cn/movies" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> 影视 </a>  <a href="/zh-cn/about" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> 关于 </a>  <div class="language-dropdown" data-astro-cid-d2mhfzrs> <button class="dropdown-trigger" id="language-trigger" data-astro-cid-d2mhfzrs> <span data-astro-cid-d2mhfzrs>语言</span> <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-d2mhfzrs> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" data-astro-cid-d2mhfzrs></path> </svg> </button> <div class="dropdown-menu" id="language-menu" data-astro-cid-d2mhfzrs> <a href="/zh-cn/blog/frontend/strapi/" class="dropdown-item active" data-lang="zh-cn" data-astro-cid-d2mhfzrs> <span class="lang-name" data-astro-cid-d2mhfzrs>简体中文</span> <svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-astro-cid-d2mhfzrs> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" data-astro-cid-d2mhfzrs></path> </svg> </a><a href="/en/blog/frontend/strapi/" class="dropdown-item " data-lang="en" data-astro-cid-d2mhfzrs> <span class="lang-name" data-astro-cid-d2mhfzrs>English</span>  </a> </div> </div>  <script type="module">document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("language-trigger"),t=document.getElementById("language-menu"),r=document.querySelector(".language-dropdown");if(!o||!t||!r)return;const s=()=>{t.classList.toggle("show");const e=o.querySelector(".dropdown-arrow");e&&(e.style.transform=t.classList.contains("show")?"rotate(180deg)":"")};o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),s()}),document.addEventListener("click",e=>{if(!r.contains(e.target)){t.classList.remove("show");const n=o.querySelector(".dropdown-arrow");n&&(n.style.transform="")}}),t.querySelectorAll(".dropdown-item").forEach(e=>{e.addEventListener("click",n=>{const a=e.getAttribute("href");a&&(window.location.href=a)})})});</script> </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <h1 data-astro-cid-bvzihdzo>「Strapi」无头CMS，快速构建API</h1> <div class="date" data-astro-cid-bvzihdzo> 2020年12月4日 </div> </div> </div> <div class="blog-content-toc-wrapper" data-astro-cid-bvzihdzo> <div class="blog-content-main prose blog-content-centered" data-astro-cid-bvzihdzo>  <h2 id="strapi-介绍"><a class="heading-link" aria-label="链接到此标题" href="#strapi-介绍">Strapi 介绍</a></h2>
<p><a href="https://github.com/strapi/strapi" class="external-link" rel="noopener noreferrer" target="_blank">Strapi</a>是一个免费的开源无头 CMS，可以快速构建自己所需的 API。</p>
<ul>
<li><strong>保持对数据的控制</strong>。使用 Strapi，可以知道数据的存储位置，并且始终可以完全控制。</li>
<li><strong>自托管</strong>。可以按照自己的方式托管和扩展 Strapi 项目。可以选择所需的任何托管平台：AWS，Netlify，Heroku，VPS 或专用服务器。您可以随增长而扩展，100％独立。</li>
<li><strong>可以选择自己喜欢的数据库</strong>。Strapi 适用于 SQL 和 NoSQL 数据库：MongoDB，PostgreSQL，MySQL，MariaDB 和 SQLite。</li>
<li><strong>可定制的</strong>。通过完全自定义 API，路由或插件来完全满足需求，从而快速构建逻辑。</li>
</ul>
<h2 id="安装"><a class="heading-link" aria-label="链接到此标题" href="#安装">安装</a></h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># 使用 yarn 安装</span></span>
<span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> create</span><span style="color:#9ECBFF"> strapi-app</span><span style="color:#9ECBFF"> my-project</span><span style="color:#79B8FF"> --quickstart</span></span>
<span class="line"><span style="color:#6A737D"># 使用  npm/npx 或者 安装</span></span>
<span class="line"><span style="color:#B392F0">npx</span><span style="color:#9ECBFF"> create-strapi-app</span><span style="color:#9ECBFF"> my-project</span><span style="color:#79B8FF"> --quickstart</span></span>
<span class="line"><span style="color:#6A737D"># 启动开发模式</span></span>
<span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> dev</span></span>
<span class="line"><span style="color:#6A737D"># 生产模式</span></span>
<span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> start</span></span>
<span class="line"><span style="color:#6A737D"># 重新构建</span></span>
<span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> build</span></span></code></pre>
<p>可以打开<code>config/server.js</code>文件,修改启动端口号</p>
<p>初次安装完会弹出一个页面,让你注册管理员账号
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dcb7dc1acf5b433f82705e0215d303ce~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h2 id="使用"><a class="heading-link" aria-label="链接到此标题" href="#使用">使用</a></h2>
<p>在登录成功后</p>
<ol>
<li>
<p>点击左侧菜单栏的<strong>内容类型生成器</strong></p>
</li>
<li>
<p>点击创建一个新的<strong>Content Type</strong></p>
</li>
<li>
<p>输入名称,在高级设置里,将<strong>Draft/publish system</strong>选择<strong>OFF</strong>(取消每次发布文章为草稿)点击继续(这里的名称就是后面 api 路径名,即 api/name )</p>
</li>
<li>
<p>选择自己所需的字段并创建,最后点击完成,应用重启.</p>
</li>
<li>
<p>在左侧菜单栏<strong>COLLECTION TYPES</strong>分类下,就会出现刚刚创建的内容
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1608bdda3cd46038681bdf60051e797~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
</li>
<li>
<p>点击新建,输入内容后保存.(倘若第三步没有选择<strong>OFF</strong>,还要点击保存旁边的<strong>Publish</strong>).此时访问<code>http://localhost:1337/tests</code>显示<strong>statusCode: 403</strong>.</p>
</li>
<li>
<p>点击左侧菜单栏的<strong>设置/角色与权限/Public</strong>,勾选<strong>find</strong>和<strong>find one</strong>,保存.</p>
</li>
<li>
<p>此时访问<code>http://localhost:1337/tests</code>便可显示数据内容</p>
</li>
</ol>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59cc3ae342a147bf85ad0a61c4c858bf~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h2 id="定制富文本编辑器"><a class="heading-link" aria-label="链接到此标题" href="#定制富文本编辑器">定制富文本编辑器</a></h2>
<p>这里以<strong>CKEditor5</strong>为例,其定制教程查看<a href="https://juejin.cn/post/6902279323818917902" class="external-link" rel="noopener noreferrer" target="_blank">「CKEditor5」富文本编辑器定制</a>,定制完成后复制<code>build</code>文件夹下的<code>ckeditor.js</code>和<code>translations</code>文件夹.</p>
<h3 id="1-生成插件并安装依赖"><a class="heading-link" aria-label="链接到此标题" href="#1-生成插件并安装依赖">1. 生成插件并安装依赖</a></h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> strapi</span><span style="color:#9ECBFF"> generate:plugin</span><span style="color:#9ECBFF"> wysiwyg</span></span>
<span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> plugins/wysiwyg</span></span>
<span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> add</span><span style="color:#9ECBFF"> @ckeditor/ckeditor5-react</span><span style="color:#9ECBFF"> @ckeditor/ckeditor5-build-classic</span></span></code></pre>
<h3 id="2创建-medialib"><a class="heading-link" aria-label="链接到此标题" href="#2创建-medialib">2.创建 MediaLib</a></h3>
<p><strong>Path</strong> — <code>./plugins/wysiwyg/admin/src/components/MediaLib/index.js</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> React, { useEffect, useState } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "react"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { useStrapi, prefixFileUrlWithBackendUrl } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "strapi-helper-plugin"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> PropTypes </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "prop-types"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> MediaLib</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ({ </span><span style="color:#FFAB70">isOpen</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">onChange</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">onToggle</span><span style="color:#E1E4E8"> }) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#FFAB70">    strapi</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#FFAB70">      componentApi</span><span style="color:#E1E4E8">: { </span><span style="color:#79B8FF">getComponent</span><span style="color:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#E1E4E8">  } </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useStrapi</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">data</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setData</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">isDisplayed</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setIsDisplayed</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  useEffect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (isOpen) {</span></span>
<span class="line"><span style="color:#B392F0">      setIsDisplayed</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  }, [isOpen]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> Component</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> getComponent</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"media-library"</span><span style="color:#E1E4E8">).Component;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> handleInputChange</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (data) {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">url</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">      setData</span><span style="color:#E1E4E8">({ </span><span style="color:#F97583">...</span><span style="color:#E1E4E8">data, url: </span><span style="color:#B392F0">prefixFileUrlWithBackendUrl</span><span style="color:#E1E4E8">(url) });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> handleClosed</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (data) {</span></span>
<span class="line"><span style="color:#B392F0">      onChange</span><span style="color:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    setData</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    setIsDisplayed</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (Component </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> isDisplayed) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">Component</span></span>
<span class="line"><span style="color:#B392F0">        allowedTypes</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{[</span><span style="color:#9ECBFF">"images"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"videos"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"files"</span><span style="color:#E1E4E8">]}</span></span>
<span class="line"><span style="color:#B392F0">        isOpen</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{isOpen}</span></span>
<span class="line"><span style="color:#B392F0">        multiple</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#B392F0">        noNavigation</span></span>
<span class="line"><span style="color:#B392F0">        onClosed</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{handleClosed}</span></span>
<span class="line"><span style="color:#B392F0">        onInputMediaChange</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{handleInputChange}</span></span>
<span class="line"><span style="color:#B392F0">        onToggle</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{onToggle}</span></span>
<span class="line"><span style="color:#E1E4E8">      /></span></span>
<span class="line"><span style="color:#E1E4E8">    );</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">MediaLib.defaultProps </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  isOpen: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">  onChange</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {},</span></span>
<span class="line"><span style="color:#B392F0">  onToggle</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {},</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">MediaLib.propTypes </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  isOpen: PropTypes.bool,</span></span>
<span class="line"><span style="color:#E1E4E8">  onChange: PropTypes.func,</span></span>
<span class="line"><span style="color:#E1E4E8">  onToggle: PropTypes.func,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> MediaLib;</span></span></code></pre>
<h3 id="3创建-wysiwyg"><a class="heading-link" aria-label="链接到此标题" href="#3创建-wysiwyg">3.创建 WYSIWYG</a></h3>
<p><strong>Path</strong> — <code>./plugins/wysiwyg/admin/src/components/Wysiwyg/index.js</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> React, { useState } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "react"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> PropTypes </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "prop-types"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { isEmpty } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "lodash"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Button } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "@buffetjs/core"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Label, InputDescription, InputErrors } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "strapi-helper-plugin"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Editor </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "../CKEditor"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> MediaLib </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "../MediaLib"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> Wysiwyg</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#E1E4E8">  inputDescription,</span></span>
<span class="line"><span style="color:#E1E4E8">  errors,</span></span>
<span class="line"><span style="color:#E1E4E8">  label,</span></span>
<span class="line"><span style="color:#E1E4E8">  name,</span></span>
<span class="line"><span style="color:#E1E4E8">  noErrorsDescription,</span></span>
<span class="line"><span style="color:#E1E4E8">  onChange,</span></span>
<span class="line"><span style="color:#E1E4E8">  value,</span></span>
<span class="line"><span style="color:#E1E4E8">}) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">isOpen</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">setIsOpen</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> useState</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> spacer </span><span style="color:#F97583">=</span><span style="color:#F97583"> !</span><span style="color:#B392F0">isEmpty</span><span style="color:#E1E4E8">(inputDescription) </span><span style="color:#F97583">?</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> style</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{{ height: </span><span style="color:#9ECBFF">".4rem"</span><span style="color:#E1E4E8"> }} /></span></span>
<span class="line"><span style="color:#E1E4E8">  ) </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">noErrorsDescription </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#F97583"> !</span><span style="color:#B392F0">isEmpty</span><span style="color:#E1E4E8">(errors)) {</span></span>
<span class="line"><span style="color:#E1E4E8">    spacer </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8"> />;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> handleChange</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (data.mime.</span><span style="color:#B392F0">includes</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"image"</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> imgTag</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> `&#x3C;p>&#x3C;img src="${</span><span style="color:#E1E4E8">data</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">url</span><span style="color:#9ECBFF">}" caption="${</span><span style="color:#E1E4E8">data</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">caption</span><span style="color:#9ECBFF">}" alt="${</span><span style="color:#E1E4E8">data</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">alternativeText</span><span style="color:#9ECBFF">}">&#x3C;/img>&#x3C;/p>`</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> newValue</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">?</span><span style="color:#9ECBFF"> `${</span><span style="color:#E1E4E8">value</span><span style="color:#9ECBFF">}${</span><span style="color:#E1E4E8">imgTag</span><span style="color:#9ECBFF">}`</span><span style="color:#F97583"> :</span><span style="color:#E1E4E8"> imgTag;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">      onChange</span><span style="color:#E1E4E8">({ target: { name, value: newValue } });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Handle videos and other type of files by adding some code</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> handleToggle</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#B392F0"> setIsOpen</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">prev</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">prev);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">div</span></span>
<span class="line"><span style="color:#B392F0">      style</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#E1E4E8">        marginBottom: </span><span style="color:#9ECBFF">"1.6rem"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        fontSize: </span><span style="color:#9ECBFF">"1.3rem"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        fontFamily: </span><span style="color:#9ECBFF">"Lato"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#E1E4E8">    ></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">Label</span><span style="color:#B392F0"> htmlFor</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{name} </span><span style="color:#B392F0">message</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{label} </span><span style="color:#B392F0">style</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{{ marginBottom: </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8"> }} /></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#79B8FF">Button</span><span style="color:#B392F0"> color</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"primary"</span><span style="color:#B392F0"> onClick</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{handleToggle}></span></span>
<span class="line"><span style="color:#E1E4E8">          MediaLib</span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;/</span><span style="color:#79B8FF">Button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">Editor</span><span style="color:#B392F0"> name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{name} </span><span style="color:#B392F0">onChange</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{onChange} </span><span style="color:#B392F0">value</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{value} /></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">InputDescription</span></span>
<span class="line"><span style="color:#B392F0">        message</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{inputDescription}</span></span>
<span class="line"><span style="color:#B392F0">        style</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{</span><span style="color:#F97583">!</span><span style="color:#B392F0">isEmpty</span><span style="color:#E1E4E8">(inputDescription) </span><span style="color:#F97583">?</span><span style="color:#E1E4E8"> { marginTop: </span><span style="color:#9ECBFF">"1.4rem"</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> {}}</span></span>
<span class="line"><span style="color:#E1E4E8">      /></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">InputErrors</span></span>
<span class="line"><span style="color:#B392F0">        errors</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{(</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">noErrorsDescription </span><span style="color:#F97583">&#x26;&#x26;</span><span style="color:#E1E4E8"> errors) </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> []}</span></span>
<span class="line"><span style="color:#B392F0">        name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{name}</span></span>
<span class="line"><span style="color:#E1E4E8">      /></span></span>
<span class="line"><span style="color:#E1E4E8">      {spacer}</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">MediaLib</span></span>
<span class="line"><span style="color:#B392F0">        onToggle</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{handleToggle}</span></span>
<span class="line"><span style="color:#B392F0">        isOpen</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{isOpen}</span></span>
<span class="line"><span style="color:#B392F0">        onChange</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{handleChange}</span></span>
<span class="line"><span style="color:#E1E4E8">      /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">Wysiwyg.defaultProps </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  errors: [],</span></span>
<span class="line"><span style="color:#E1E4E8">  inputDescription: </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  label: </span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  noErrorsDescription: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  value: </span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">Wysiwyg.propTypes </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  errors: PropTypes.array,</span></span>
<span class="line"><span style="color:#E1E4E8">  inputDescription: PropTypes.</span><span style="color:#B392F0">oneOfType</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">    PropTypes.string,</span></span>
<span class="line"><span style="color:#E1E4E8">    PropTypes.func,</span></span>
<span class="line"><span style="color:#E1E4E8">    PropTypes.</span><span style="color:#B392F0">shape</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      id: PropTypes.string,</span></span>
<span class="line"><span style="color:#E1E4E8">      params: PropTypes.object,</span></span>
<span class="line"><span style="color:#E1E4E8">    }),</span></span>
<span class="line"><span style="color:#E1E4E8">  ]),</span></span>
<span class="line"><span style="color:#E1E4E8">  label: PropTypes.</span><span style="color:#B392F0">oneOfType</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">    PropTypes.string,</span></span>
<span class="line"><span style="color:#E1E4E8">    PropTypes.func,</span></span>
<span class="line"><span style="color:#E1E4E8">    PropTypes.</span><span style="color:#B392F0">shape</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">      id: PropTypes.string,</span></span>
<span class="line"><span style="color:#E1E4E8">      params: PropTypes.object,</span></span>
<span class="line"><span style="color:#E1E4E8">    }),</span></span>
<span class="line"><span style="color:#E1E4E8">  ]),</span></span>
<span class="line"><span style="color:#E1E4E8">  name: PropTypes.string.isRequired,</span></span>
<span class="line"><span style="color:#E1E4E8">  noErrorsDescription: PropTypes.bool,</span></span>
<span class="line"><span style="color:#E1E4E8">  onChange: PropTypes.func.isRequired,</span></span>
<span class="line"><span style="color:#E1E4E8">  value: PropTypes.string,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Wysiwyg;</span></span></code></pre>
<h3 id="4创建-ckeditor"><a class="heading-link" aria-label="链接到此标题" href="#4创建-ckeditor">4.创建 CKEditor</a></h3>
<p><strong>Path</strong> — <code>./plugins/wysiwyg/admin/src/components/CKEditor/index.js</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> React </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "react"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> PropTypes </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "prop-types"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { CKEditor } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "@ckeditor/ckeditor5-react"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> ClassicEditor </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "@ckeditor/ckeditor5-build-classic"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> styled </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "styled-components"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> Wrapper</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> styled.</span><span style="color:#B392F0">div</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">  .ck-editor__main {</span></span>
<span class="line"><span style="color:#9ECBFF">    min-height: 200px;</span></span>
<span class="line"><span style="color:#9ECBFF">    > div {</span></span>
<span class="line"><span style="color:#9ECBFF">      min-height: 200px;</span></span>
<span class="line"><span style="color:#9ECBFF">    }</span></span>
<span class="line"><span style="color:#9ECBFF">  }</span></span>
<span class="line"><span style="color:#9ECBFF">`</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> configuration</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  toolbar: [</span></span>
<span class="line"><span style="color:#9ECBFF">    "heading"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "|"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "bold"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "italic"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "link"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "bulletedList"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "numberedList"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "|"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "indent"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "outdent"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "|"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "blockQuote"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "insertTable"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "mediaEmbed"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "undo"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    "redo"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> Editor</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ({ </span><span style="color:#FFAB70">onChange</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8"> }) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#79B8FF">Wrapper</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#79B8FF">CKEditor</span></span>
<span class="line"><span style="color:#B392F0">        editor</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{ClassicEditor}</span></span>
<span class="line"><span style="color:#B392F0">        config</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{configuration}</span></span>
<span class="line"><span style="color:#B392F0">        data</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{value}</span></span>
<span class="line"><span style="color:#B392F0">        onChange</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">{(</span><span style="color:#FFAB70">event</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">editor</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">          const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> editor.</span><span style="color:#B392F0">getData</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">          onChange</span><span style="color:#E1E4E8">({ target: { name, value: data } });</span></span>
<span class="line"><span style="color:#E1E4E8">        }}</span></span>
<span class="line"><span style="color:#E1E4E8">      /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#79B8FF">Wrapper</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">Editor.propTypes </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  onChange: PropTypes.func.isRequired,</span></span>
<span class="line"><span style="color:#E1E4E8">  name: PropTypes.string.isRequired,</span></span>
<span class="line"><span style="color:#E1E4E8">  value: PropTypes.string,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> Editor;</span></span></code></pre>
<h3 id="5覆盖-wysiwyg修改插件前端入口"><a class="heading-link" aria-label="链接到此标题" href="#5覆盖-wysiwyg修改插件前端入口">5.覆盖 WYSIWYG,修改插件前端入口</a></h3>
<p>替换下面文件的内容</p>
<p><strong>Path</strong> — <code>./plugins/wysiwyg/admin/src/index.js</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pluginPkg </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "../../package.json"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Wysiwyg </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "./components/Wysiwyg"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> pluginId </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> "./pluginId"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">strapi</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> pluginDescription</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#E1E4E8">    pluginPkg.strapi.description </span><span style="color:#F97583">||</span><span style="color:#E1E4E8"> pluginPkg.description;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> plugin</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    blockerComponent: </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    blockerComponentProps: {},</span></span>
<span class="line"><span style="color:#E1E4E8">    description: pluginDescription,</span></span>
<span class="line"><span style="color:#E1E4E8">    icon: pluginPkg.strapi.icon,</span></span>
<span class="line"><span style="color:#E1E4E8">    id: pluginId,</span></span>
<span class="line"><span style="color:#B392F0">    initializer</span><span style="color:#E1E4E8">: () </span><span style="color:#F97583">=></span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    injectedComponents: [],</span></span>
<span class="line"><span style="color:#E1E4E8">    isReady: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    isRequired: pluginPkg.strapi.required </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    mainComponent: </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    name: pluginPkg.strapi.name,</span></span>
<span class="line"><span style="color:#E1E4E8">    preventComponentRendering: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    settings: </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    trads: {},</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  strapi.</span><span style="color:#B392F0">registerField</span><span style="color:#E1E4E8">({ type: </span><span style="color:#9ECBFF">"wysiwyg"</span><span style="color:#E1E4E8">, Component: Wysiwyg });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> strapi.</span><span style="color:#B392F0">registerPlugin</span><span style="color:#E1E4E8">(plugin);</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<h3 id="6-替换自己定制的-ckeditor5"><a class="heading-link" aria-label="链接到此标题" href="#6-替换自己定制的-ckeditor5">6. 替换自己定制的 CKEditor5</a></h3>
<ol>
<li>将开始复制的<code>ckeditor.js</code>和<code>translations</code>文件夹拷贝到<code>plugins/wysiwyg/admin/src/components/CKEditor</code>文件夹下</li>
<li>修改<code>plugins/wysiwyg/admin/src/components/CKEditor/index.js</code>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#FDAEB7"><span style="user-select: none;">-</span> import ClassicEditor from '@ckeditor/ckeditor5-build-classic';</span></span>
<span class="line"><span style="color:#85E89D"><span style="user-select: none;">+</span> import ClassicEditor from "./ckeditor";</span></span></code></pre>
</li>
<li>重新构建文件,查看效果</li>
</ol>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> build</span></span>
<span class="line"><span style="color:#B392F0">yarn</span><span style="color:#9ECBFF"> dev</span></span></code></pre>
<h2 id="参考"><a class="heading-link" aria-label="链接到此标题" href="#参考">参考</a></h2>
<ul>
<li><a href="https://strapi.io/documentation/v3.x/guides/registering-a-field-in-admin.html#introduction" class="external-link" rel="noopener noreferrer" target="_blank">创建一个新插件来在 CKEditor 中更改所见即所得</a></li>
<li><a href="https://github.com/gtomato/ckeditor5-strapi-upload-plugin" class="external-link" rel="noopener noreferrer" target="_blank">ckeditor5-strapi-upload-plugin</a></li>
</ul>  </div> <nav class="toc-sidebar" data-astro-cid-bvzihdzo> <h4 data-astro-cid-bvzihdzo>目录</h4> <ul data-astro-cid-bvzihdzo> <li class="toc-item toc-h2" data-astro-cid-bvzihdzo> <a href="#strapi-介绍" data-astro-cid-bvzihdzo>Strapi 介绍</a> </li><li class="toc-item toc-h2" data-astro-cid-bvzihdzo> <a href="#安装" data-astro-cid-bvzihdzo>安装</a> </li><li class="toc-item toc-h2" data-astro-cid-bvzihdzo> <a href="#使用" data-astro-cid-bvzihdzo>使用</a> </li><li class="toc-item toc-h2" data-astro-cid-bvzihdzo> <a href="#定制富文本编辑器" data-astro-cid-bvzihdzo>定制富文本编辑器</a> </li><li class="toc-item toc-h3" data-astro-cid-bvzihdzo> <a href="#1-生成插件并安装依赖" data-astro-cid-bvzihdzo>1. 生成插件并安装依赖</a> </li><li class="toc-item toc-h3" data-astro-cid-bvzihdzo> <a href="#2创建-medialib" data-astro-cid-bvzihdzo>2.创建 MediaLib</a> </li><li class="toc-item toc-h3" data-astro-cid-bvzihdzo> <a href="#3创建-wysiwyg" data-astro-cid-bvzihdzo>3.创建 WYSIWYG</a> </li><li class="toc-item toc-h3" data-astro-cid-bvzihdzo> <a href="#4创建-ckeditor" data-astro-cid-bvzihdzo>4.创建 CKEditor</a> </li><li class="toc-item toc-h3" data-astro-cid-bvzihdzo> <a href="#5覆盖-wysiwyg修改插件前端入口" data-astro-cid-bvzihdzo>5.覆盖 WYSIWYG,修改插件前端入口</a> </li><li class="toc-item toc-h3" data-astro-cid-bvzihdzo> <a href="#6-替换自己定制的-ckeditor5" data-astro-cid-bvzihdzo>6. 替换自己定制的 CKEditor5</a> </li><li class="toc-item toc-h2" data-astro-cid-bvzihdzo> <a href="#参考" data-astro-cid-bvzihdzo>参考</a> </li> </ul> </nav> </div> </article> </main> <footer data-astro-cid-sz7xmlte>
logyxiao's Blog-&copy; 2025 - by Astro.
<div class="social-links" data-astro-cid-sz7xmlte></div> </footer>  <script>
if (typeof window !== 'undefined') {
	window.addEventListener('DOMContentLoaded', () => {
		const main = document.querySelector('.blog-content-main');
		if (!main) return;

		// 代码块复制按钮
		main.querySelectorAll('pre code').forEach(block => {
			const pre = block.parentElement;
			if (!pre) return;
			const btn = document.createElement('button');
			btn.className = 'copy-btn';
			btn.type = 'button';
			btn.innerText = '复制';
			btn.onclick = () => {
				navigator.clipboard.writeText(block.innerText);
				btn.innerText = '已复制!';
				setTimeout(() => { btn.innerText = '复制'; }, 1200);
			};
			pre.style.position = 'relative';
			btn.style.position = 'absolute';
			btn.style.top = '8px';
			btn.style.right = '12px';
			pre.appendChild(btn);
		});
	});
}
</script> </body></html>